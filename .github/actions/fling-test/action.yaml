name: Test-flinging
description: Submit a job YAML to a Testflinger server
inputs:
  job:
    description: "Job YAML string (see https://canonical-testflinger.readthedocs-hosted.com/en/latest/reference/job-schema/ for more info)"
    required: true
  server:
    description: The Testflinger server to use
    required: false
    default: testflinger.canonical.com
runs:
  using: composite
  steps:
    - name: Install prerequisites
      shell: bash
      run: |
        sudo snap install testflinger-cli

    - name: Test connection to Testflinger server
      shell: bash
      run: |
        nc -vz ${{ inputs.server }} 443

    - name: "Display job"
      shell: bash
      run: |
        echo ${{ inputs.job }}
        #JOB_FILE=${{ github.workspace }}/job.yaml
        #echo "${{ inputs.job }}" > $JOB_FILE
        # echo "${{ inputs.job }}" | yq eval -P - > job.yaml
        # diagnostics
        #echo "Job file to be submitted"
        #cat $JOB_FILE
